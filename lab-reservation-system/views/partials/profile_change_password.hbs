<div class="change-password-container" style="max-width:400px;margin:0 auto;padding:0;background:none;">
  <h2 style="text-align:center;color:#1a237e;font-weight:700;margin-bottom:18px;">Change Password</h2>
  <form id="change-password-form" style="background:#fff;padding:24px 20px 16px 20px;border-radius:16px;box-shadow:0 2px 12px #7EAE96cc;display:flex;flex-direction:column;gap:18px;border:1.5px solid #7EAE96;">
    <div style="display:flex;flex-direction:column;gap:6px;">
      <label style="font-weight:600;color:#364b46;" for="currentPassword">Current Password</label>
      <input type="password" id="currentPassword" name="currentPassword" style="padding:8px 12px;border:1px solid #bfc7d5;border-radius:8px;font-size:1em;background:#f5f5f5;color:#222;" required />
      <span id="error-currentPassword" style="color:#c0392b;font-size:0.98em;margin-top:2px;"></span>
    </div>
    <div style="display:flex;flex-direction:column;gap:6px;">
      <label style="font-weight:600;color:#364b46;" for="newPassword">New Password</label>
      <input type="password" id="newPassword" name="newPassword" style="padding:8px 12px;border:1px solid #bfc7d5;border-radius:8px;font-size:1em;background:#f5f5f5;color:#222;" required />
      <span id="error-newPassword" style="color:#c0392b;font-size:0.98em;margin-top:2px;"></span>
    </div>
    <div style="display:flex;flex-direction:column;gap:6px;">
      <label style="font-weight:600;color:#364b46;" for="confirmNewPassword">Confirm New Password</label>
      <input type="password" id="confirmNewPassword" name="confirmNewPassword" style="padding:8px 12px;border:1px solid #bfc7d5;border-radius:8px;font-size:1em;background:#f5f5f5;color:#222;" required />
      <span id="error-confirmNewPassword" style="color:#c0392b;font-size:0.98em;margin-top:2px;"></span>
    </div>
    <button type="submit" style="background:#364b46;color:#fff;font-weight:700;border:none;border-radius:10px;padding:12px 0;font-size:1.08em;box-shadow:0 2px 12px #7EAE9644;cursor:pointer;transition:background 0.2s;">Change Password</button>
  </form>
  <script>
    document.getElementById('change-password-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      // Clear previous errors
      document.getElementById('error-currentPassword').textContent = '';
      document.getElementById('error-newPassword').textContent = '';
      document.getElementById('error-confirmNewPassword').textContent = '';

      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmNewPassword = document.getElementById('confirmNewPassword').value;
      let hasError = false;

      if (newPassword !== confirmNewPassword) {
        document.getElementById('error-confirmNewPassword').textContent = 'New passwords do not match.';
        hasError = true;
      }
      if (newPassword.length < 8) {
        document.getElementById('error-newPassword').textContent = 'Password must be at least 8 characters long.';
        hasError = true;
      }
      // Add more client-side checks if needed
      if (hasError) return;

      try {
        const res = await fetch('/change-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ currentPassword, newPassword })
        });
        const data = await res.json();
        if (res.ok) {
          alert('Password changed successfully.');
          document.getElementById('change-password-form').reset();
          document.getElementById('changePasswordModal').style.display = 'none';
        } else {
          // Show server error inline
          if (data.message && data.message.toLowerCase().includes('current password')) {
            document.getElementById('error-currentPassword').textContent = data.message;
          } else if (data.message && data.message.toLowerCase().includes('password')) {
            document.getElementById('error-newPassword').textContent = data.message;
          } else {
            document.getElementById('error-newPassword').textContent = data.message || 'Error changing password.';
          }
        }
      } catch (err) {
        document.getElementById('error-newPassword').textContent = 'Server error.';
      }
    });
  </script>
</div>
